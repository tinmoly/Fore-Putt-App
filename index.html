<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fore!Putt Practice App ‚Äî Version 1.7.1</title>

  <style>
    body{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;background:#0b3d2e;color:#fff;margin:0;padding:20px}
    body.flash-green{animation:flashGreen .15s ease-in-out}
    body.flash-red{animation:flashRed .15s ease-in-out}
    @keyframes flashGreen{from{background:#0b3d2e}to{background:#145a43}}
    @keyframes flashRed{from{background:#0b3d2e}to{background:#6b2a2a}}

    .card{background:#145a43;border-radius:14px;padding:20px;max-width:460px;margin:0 auto;box-shadow:0 10px 25px rgba(0,0,0,.3)}
    h1,h3{text-align:center;margin-bottom:10px}

    .distance-row{display:flex;gap:8px;overflow-x:auto;margin-bottom:12px}
    .distance-btn{background:#1c7c5b;border:none;padding:10px 18px;border-radius:999px;font-weight:800;color:#fff;cursor:pointer;white-space:nowrap;font-size:22px}
    .distance-btn.active{background:#2ecc71;color:#000}

    button{width:100%;border:none;border-radius:14px;cursor:pointer;font-weight:800;margin-top:10px}
    .made,.missed{height:96px;font-size:32px}
    .made{background:#2ecc71;color:#000}
    .missed{background:#E34234;color:#000}
    button:active{transform:scale(.97)}

    .stats{text-align:center;font-size:18px;margin-top:20px}
    .badge{margin-top:10px;padding:10px;border-radius:10px;text-align:center;background:#0e4f3a}
    .badge.met{background:#1f7a4a}.badge.not-met{background:#6b2a2a}

    .history-card{padding:10px;margin-bottom:8px;background:#1c7c5b;border-radius:10px;cursor:pointer}
    .progress{height:6px;background:rgba(255,255,255,.2);border-radius:999px;margin-top:6px}
    .progress-fill{height:100%;background:#2ecc71;border-radius:999px}
  </style>
</head>
<body>
<div class="card">
  <h1 id="distanceTitle">2-Foot Putts</h1>
  <div id="distanceRow" class="distance-row"></div>

  <div style="display:flex;gap:10px;">
    <button class="made" onclick="recordMade()">‚úÖ Made</button>
    <button class="missed" onclick="recordMissed()">‚õî Missed</button>
  </div>

  <div class="stats">
    <p>Made: <span id="made">0</span> | Missed: <span id="missed">0</span></p>
    <p>‚õ≥ Make %: <span id="percent">0</span>%</p>
    <p><span id="streakLabel">Streak</span>: <span id="streak">0</span></p>
  </div>

  <div id="targetBadge" class="badge"></div>

  <button onclick="newSession()" style="background:#0096FF;color:#000;height:48px;font-size:24px">üîÑ New Session</button>

  <div style="display:flex;justify-content:space-between;align-items:center;margin-top:18px">
    <h3 style="margin:0">Session History</h3>
    <select id="historyAction" onchange="handleHistoryAction()" style="background:#1c7c5b;color:#fff;border:none;border-radius:8px;padding:6px 8px;font-weight:700">
      <option value="">Actions</option>
      <option value="export">Export All History</option>
      <option value="delete">Clear All History</option>
    </select>
  </div>
  <div id="history"></div>

  <div id="sessionDetail" style="display:none;margin-top:16px;padding:12px;background:#0e4f3a;border-radius:12px">
    <h3 id="sessionDetailTitle">Session Details</h3>
    <div id="sessionDetailBody"></div>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
      <button onclick="deleteSession()" style="background:#E34234;color:#000;padding:10px 14px;border-radius:10px">üóëÔ∏è Delete</button>
      <button onclick="closeSessionDetail()" style="background:#888;color:#000;padding:10px 14px;border-radius:10px">‚ùå Close</button>
    </div>
  </div>
</div>

<script>
/* ---------- DATA ---------- */
const DISTANCES=[2,3,4,5,6,7,8,9,10,15,20,30];
const PGA_TOUR_AVG={2:99,3:96,4:88,5:77,6:66,7:58,8:50,9:45,10:40,15:23,20:15,30:7};

let currentDistance=2;
let stats=loadStats();
let streaks=loadStreaks();
let sessions=loadSessions();

const $=id=>document.getElementById(id);

/* ---------- UTIL ---------- */
let tapLocked=false;const TAP_DELAY=300;
function withTapLock(fn){if(tapLocked)return;tapLocked=true;fn();setTimeout(()=>tapLocked=false,TAP_DELAY)}
function haptic(ms){if(navigator.vibrate)navigator.vibrate(ms)}
function flash(cls){document.body.classList.add(cls);setTimeout(()=>document.body.classList.remove(cls),150)}

function getStreakEmojis(val){if(val>=10)return'üî•üî•üî•üî•üî•';if(val>=5)return'üî•üî•üî•';if(val>=3)return'üî•üî•';if(val>=1)return'üî•';return''}

/* ---------- STORAGE ---------- */
function defaultStats(){const o={};DISTANCES.forEach(d=>o[d]={made:0,missed:0});return o}
function loadStats(){const s=JSON.parse(localStorage.getItem('puttingStats'));const b=defaultStats();if(!s)return b;DISTANCES.forEach(d=>{if(s[d])b[d]=s[d]});return b}
function saveStats(){localStorage.setItem('puttingStats',JSON.stringify(stats))}

function loadStreaks(){const s=JSON.parse(localStorage.getItem('puttingStreaks'))||{};const b={};DISTANCES.forEach(d=>b[d]=s[d]||0);return b}
function saveStreaks(){localStorage.setItem('puttingStreaks',JSON.stringify(streaks))}

function loadSessions(){return JSON.parse(localStorage.getItem('puttingSessions'))||[]}
function saveSessions(){localStorage.setItem('puttingSessions',JSON.stringify(sessions))}

/* ---------- UI ---------- */
function buildDistanceRow(){
  const row=$('distanceRow');
  row.innerHTML='';
  DISTANCES.forEach(d=>{
    const b=document.createElement('button');
    b.className='distance-btn'+(d===currentDistance?' active':'');
    b.textContent=d+"'";
    b.onclick=()=>setDistance(d);
    row.appendChild(b);
  });
}

function setDistance(d){
  currentDistance=d;
  $('distanceTitle').textContent=`${d}-Foot Putts`;
  buildDistanceRow();
  updateStats();
}

function updateStats(){
  const {made,missed}=stats[currentDistance];
  const total=made+missed;
  const pct=total?Math.round(made/total*100):0;
  $('made').textContent=made;
  $('missed').textContent=missed;
  $('percent').textContent=pct;
  const sVal=streaks[currentDistance]||0;
  $('streak').textContent=sVal;
  $('streakLabel').textContent=`${getStreakEmojis(sVal)} Streak`.trim();
  const target=PGA_TOUR_AVG[currentDistance];
  $('targetBadge').className='badge '+(pct>=target?'met':'not-met');
  $('targetBadge').innerHTML=pct>=target
    ? `üèÜ Better than PGA Tour Avg!<br>üéØ Target: ${target}%`
    : `üéØ Target: ${target}% PGA Tour Avg`;
}

/* ---------- ACTIONS ---------- */
function recordMade(){
  withTapLock(()=>{
    stats[currentDistance].made++;
    streaks[currentDistance]++;
    flash('flash-green');
    haptic(20);
    saveStats();
    saveStreaks();
    updateStats();
  });
}

function recordMissed(){
  withTapLock(()=>{
    stats[currentDistance].missed++;
    streaks[currentDistance]=0;
    flash('flash-red');
    haptic([10,40]);
    saveStats();
    saveStreaks();
    updateStats();
  });
}

function newSession(){
  if(!confirm('Start a new session?'))return;
  sessions.push({date:new Date().toISOString(),stats:JSON.parse(JSON.stringify(stats))});
  saveSessions();
  stats=defaultStats();
  streaks={};
  DISTANCES.forEach(d=>streaks[d]=0);
  saveStats();
  saveStreaks();
  updateStats();
  renderHistory();
}

function handleHistoryAction(){
  const sel=$('historyAction');
  const v=sel.value;
  sel.value='';

  if(v==='delete'){
    if(!confirm('Delete all session history?'))return;
    sessions=[];
    saveSessions();
    closeSessionDetail();
    renderHistory();
    return;
  }

  if(v==='export'){
    exportHistoryCSV();
  }
}

function exportHistoryCSV(){
  if(!sessions.length){alert('No session history to export.');return}
  let csv='Session,Date,Time,Distance,Made,Missed,Total,Make%\n';
  sessions.forEach((s,i)=>{
    const date=new Date(s.date).toLocaleString();
    DISTANCES.forEach(d=>{
      const st=s.stats[d]||{made:0,missed:0};
      const t=st.made+st.missed;
      if(t===0)return;
      const p=Math.round(st.made/t*100);
      csv+=`${i+1},${date},${d},${st.made},${st.missed},${t},${p}\n`;
    });
  });
  const blob=new Blob([csv],{type:'text/csv'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;
  a.download=`foreputt_history_${new Date().toISOString().slice(0,10)}.csv`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

/* ---------- HISTORY ---------- */
function renderHistory(){
  const h = $('history');
  h.innerHTML = '';

  if(!sessions.length){
    h.innerHTML = '<p style="opacity:.8">No sessions yet.</p>';
    closeSessionDetail();
    return;
  }

  sessions.slice().reverse().forEach((s,i)=>{
    let made = 0, total = 0;
    Object.values(s.stats).forEach(d=>{
      made += d.made;
      total += d.made + d.missed;
    });

    const pct = total ? Math.round(made / total * 100) : 0;
    const idx = sessions.length - 1 - i;

    const card = document.createElement('div');
    card.className = 'history-card';

    card.onclick = () => {
      const panel = $('sessionDetail');
      if(panel.style.display === 'block' && panel.dataset.index == idx){
        closeSessionDetail();
      } else {
        openSessionDetail(idx);
      }
    };

    card.innerHTML = `<strong>Session ${idx+1}</strong><br>${new Date(s.date).toLocaleDateString()} ‚Ä¢ ${pct}% (${total} putts)<div class="progress"><div class="progress-fill" style="width:${pct}%"></div></div>`;

    h.appendChild(card);
  });
}

function openSessionDetail(idx){
  const s=sessions[idx];
  $('sessionDetailTitle').textContent=`Session ${idx+1} ‚Äî ${new Date(s.date).toLocaleString()}`;
  const body=$('sessionDetailBody');
  body.innerHTML='';
  DISTANCES.forEach(d=>{
    const st=s.stats[d]||{made:0,missed:0};
    const t=st.made+st.missed;
    if(t===0)return;
    const pct=Math.round(st.made/t*100);
    const star=pct>=PGA_TOUR_AVG[d]?' ‚≠ê':'';
    const row=document.createElement('div');
    row.style.padding='6px 0';
    row.innerHTML=`<strong>${d} ft:</strong> ${st.made}/${t} (${pct}%) ‚Äî PGA ${PGA_TOUR_AVG[d]}%${star}`;
    body.appendChild(row);
  });
  $('sessionDetail').style.display='block';
  $('sessionDetail').dataset.index=idx;
}

function closeSessionDetail(){
  $('sessionDetail').style.display='none';
  $('sessionDetail').dataset.index='';
}

function deleteSession(){
  const idx=Number($('sessionDetail').dataset.index);
  if(isNaN(idx))return;
  if(!confirm('Delete this session?'))return;
  sessions.splice(idx,1);
  saveSessions();
  closeSessionDetail();
  renderHistory();
}

/* ---------- INIT ---------- */
buildDistanceRow();
updateStats();
renderHistory();
</script>
</body>
</html>
